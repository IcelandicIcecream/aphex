{"version":3,"file":"3-BonFCUTv.js","sources":["../../../.svelte-kit/adapter-node/entries/pages/_page.server.ts.js","../../../.svelte-kit/adapter-node/nodes/3.js"],"sourcesContent":["import { a as authToContext } from \"../../chunks/auth-helpers.js\";\nimport { error, fail } from \"@sveltejs/kit\";\nconst load = async ({ locals }) => {\n  try {\n    const { localAPI, databaseAdapter } = locals.aphexCMS;\n    const organization = await databaseAdapter.findOrganizationBySlug(\"default\");\n    if (!organization) {\n      return error(404, {\n        message: \"Organization doesn't exist\"\n      });\n    }\n    const auth = locals.auth;\n    let context;\n    let isLoggedIn = false;\n    let userRole = null;\n    let userName = null;\n    let result = null;\n    if (auth && auth.type == \"session\") {\n      isLoggedIn = true;\n      userRole = auth.user.role;\n      userName = auth.user.name || auth.user.email;\n      context = authToContext(auth);\n      result = await localAPI.collections.todo?.find(context, {\n        limit: 100,\n        depth: 1,\n        perspective: \"draft\",\n        where: { \"_meta.createdBy\": { equals: auth.user.id } }\n      });\n    }\n    return {\n      todos: result?.docs || [],\n      isLoggedIn,\n      userRole,\n      userName\n    };\n  } catch (err) {\n    console.error(\"Failed to fetch todos:\", err);\n    return {\n      todos: [],\n      isLoggedIn: false,\n      userRole: null,\n      userName: null\n    };\n  }\n};\nconst actions = {\n  createTodo: async ({ request, locals }) => {\n    const { localAPI } = locals.aphexCMS;\n    const data = await request.formData();\n    const title = data.get(\"title\")?.toString();\n    const description = data.get(\"description\")?.toString();\n    if (!title) {\n      return fail(400, { error: \"Title is required\" });\n    }\n    const auth = locals.auth;\n    if (!auth) {\n      return fail(401, { error: \"You must be logged in to create todos\" });\n    }\n    try {\n      const context = authToContext(auth);\n      await localAPI.collections.todo?.create(context, {\n        title,\n        description: description || \"\",\n        completed: false\n      });\n      return { success: true, action: \"create\" };\n    } catch (err) {\n      console.error(\"Failed to create todo:\", err);\n      return fail(500, { error: \"Failed to create todo\" });\n    }\n  },\n  toggleComplete: async ({ request, locals }) => {\n    const { localAPI } = locals.aphexCMS;\n    const data = await request.formData();\n    const todoId = data.get(\"id\")?.toString();\n    const completed = data.get(\"completed\") === \"true\";\n    if (!todoId) {\n      return fail(400, { error: \"Todo ID is required\" });\n    }\n    const auth = locals.auth;\n    if (!auth) {\n      return fail(401, { error: \"You must be logged in to update todos\" });\n    }\n    try {\n      const context = authToContext(auth);\n      const existingTodo = await localAPI.collections.todo?.findByID(context, todoId);\n      if (!existingTodo) {\n        return fail(404, { error: \"Todo not found\" });\n      }\n      await localAPI.collections.todo?.update(\n        context,\n        todoId,\n        {\n          title: existingTodo.title,\n          description: existingTodo.description,\n          completed: !completed\n        },\n        { publish: false }\n      );\n      return { success: true };\n    } catch (err) {\n      console.error(\"Failed to toggle todo:\", err);\n      return fail(500, { error: \"Failed to update todo\" });\n    }\n  },\n  updateTodo: async ({ request, locals }) => {\n    const { localAPI } = locals.aphexCMS;\n    const data = await request.formData();\n    const todoId = data.get(\"id\")?.toString();\n    const title = data.get(\"title\")?.toString();\n    const description = data.get(\"description\")?.toString();\n    if (!todoId || !title) {\n      return fail(400, { error: \"Todo ID and title are required\" });\n    }\n    const auth = locals.auth;\n    if (!auth) {\n      return fail(401, { error: \"You must be logged in to update todos\" });\n    }\n    try {\n      const context = authToContext(auth);\n      const existingTodo = await localAPI.collections.todo?.findByID(context, todoId);\n      if (!existingTodo) {\n        return fail(404, { error: \"Todo not found\" });\n      }\n      await localAPI.collections.todo?.update(\n        context,\n        todoId,\n        {\n          title,\n          description: description || \"\",\n          completed: existingTodo.completed\n        },\n        { publish: false }\n      );\n      return { success: true, action: \"update\" };\n    } catch (err) {\n      console.error(\"Failed to update todo:\", err);\n      return fail(500, { error: \"Failed to update todo\" });\n    }\n  },\n  deleteTodo: async ({ request, locals }) => {\n    const { localAPI } = locals.aphexCMS;\n    const data = await request.formData();\n    const todoId = data.get(\"id\")?.toString();\n    if (!todoId) {\n      return fail(400, { error: \"Todo ID is required\" });\n    }\n    const auth = locals.auth;\n    if (!auth) {\n      return fail(401, { error: \"You must be logged in to delete todos\" });\n    }\n    try {\n      const context = authToContext(auth);\n      await localAPI.collections.todo?.delete(context, todoId);\n      return { success: true, action: \"delete\" };\n    } catch (err) {\n      console.error(\"Failed to delete todo:\", err);\n      return fail(500, { error: \"Failed to delete todo\" });\n    }\n  }\n};\nexport {\n  actions,\n  load\n};\n","import * as server from '../entries/pages/_page.server.ts.js';\n\nexport const index = 3;\nlet component_cache;\nexport const component = async () => component_cache ??= (await import('../entries/pages/_page.svelte.js')).default;\nexport { server };\nexport const server_id = \"src/routes/+page.server.ts\";\nexport const imports = [\"_app/immutable/nodes/3.B4vvZeoP.js\",\"_app/immutable/chunks/DsnmJJEf.js\",\"_app/immutable/chunks/DWBROaph.js\",\"_app/immutable/chunks/zhm3sqsy.js\",\"_app/immutable/chunks/CrQaW3DA.js\",\"_app/immutable/chunks/CgH_2WnA.js\",\"_app/immutable/chunks/D8BKmG1w.js\",\"_app/immutable/chunks/CMwlA4jW.js\",\"_app/immutable/chunks/CrOXdnIQ.js\",\"_app/immutable/chunks/CQxSK_kJ.js\",\"_app/immutable/chunks/AHJMyVxs.js\",\"_app/immutable/chunks/BegLjn8u.js\",\"_app/immutable/chunks/C4tAP6mY.js\",\"_app/immutable/chunks/BVXJ_ZUV.js\"];\nexport const stylesheets = [];\nexport const fonts = [];\n"],"names":[],"mappings":"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"}