{"version":3,"file":"_server.ts-DNqVwb0W.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/api/assets/_id_/_server.ts.js"],"sourcesContent":["import { json } from \"@sveltejs/kit\";\nimport \"../../../../../chunks/storage.js\";\nimport \"sharp\";\nconst GET = async ({ params, locals }) => {\n  try {\n    const { assetService } = locals.aphexCMS;\n    const auth = locals.auth;\n    const { id } = params;\n    if (!auth) {\n      return json({ success: false, error: \"Unauthorized\" }, { status: 401 });\n    }\n    if (!id) {\n      return json({ success: false, error: \"Asset ID is required\" }, { status: 400 });\n    }\n    const asset = await assetService.findAssetById(auth.organizationId, id);\n    if (!asset) {\n      return json({ success: false, error: \"Asset not found\" }, { status: 404 });\n    }\n    return json({\n      success: true,\n      data: {\n        _type: asset.assetType === \"image\" ? \"sanity.imageAsset\" : \"sanity.fileAsset\",\n        _id: asset.id,\n        url: asset.url,\n        originalFilename: asset.originalFilename,\n        mimeType: asset.mimeType,\n        size: asset.size,\n        metadata: {\n          dimensions: asset.width && asset.height ? {\n            width: asset.width,\n            height: asset.height\n          } : void 0,\n          ...asset.metadata\n        },\n        title: asset.title,\n        description: asset.description,\n        alt: asset.alt,\n        creditLine: asset.creditLine,\n        _createdAt: asset.createdAt,\n        _updatedAt: asset.updatedAt\n      }\n    });\n  } catch (error) {\n    console.error(\"[Asset API] Error fetching asset:\", error);\n    return json({ success: false, error: \"Failed to fetch asset\" }, { status: 500 });\n  }\n};\nconst DELETE = async ({ params, locals }) => {\n  try {\n    const { id } = params;\n    const { assetService } = locals.aphexCMS;\n    const auth = locals.auth;\n    if (!auth) {\n      return json({ success: false, error: \"Unauthorized\" }, { status: 401 });\n    }\n    if (!id) {\n      return json({ success: false, error: \"Asset ID is required\" }, { status: 400 });\n    }\n    const result = await assetService.deleteAsset(auth.organizationId, id);\n    if (!result) {\n      return json({ success: false, error: \"Asset not found or could not be deleted\" }, { status: 404 });\n    }\n    return json({ success: true });\n  } catch (error) {\n    console.error(\"Error deleting asset:\", error);\n    return json({ success: false, error: \"Failed to delete asset\" }, { status: 500 });\n  }\n};\nconst PATCH = async ({ params, locals, request }) => {\n  try {\n    const { assetService } = locals.aphexCMS;\n    const auth = locals.auth;\n    const { id } = params;\n    if (!auth) {\n      return json({ success: false, error: \"Unauthorized\" }, { status: 401 });\n    }\n    if (!id) {\n      return json({ success: false, error: \"Asset ID is required\" }, { status: 400 });\n    }\n    const { title, description, alt, creditLine } = await request.json();\n    let updatedAsset;\n    if (auth.type == \"session\") {\n      updatedAsset = await assetService.updateAssetMetadata(auth.organizationId, id, {\n        title,\n        description,\n        alt,\n        creditLine,\n        updatedBy: auth.user.id\n      });\n    } else {\n      updatedAsset = await assetService.updateAssetMetadata(auth.organizationId, id, {\n        title,\n        description,\n        alt,\n        creditLine,\n        updatedBy: auth.keyId\n      });\n    }\n    if (!updatedAsset) {\n      return json({ success: false, error: \"Asset not found\" }, { status: 404 });\n    }\n    return json({\n      success: true,\n      data: {\n        _type: updatedAsset.assetType === \"image\" ? \"sanity.imageAsset\" : \"sanity.fileAsset\",\n        _id: updatedAsset.id,\n        url: updatedAsset.url,\n        originalFilename: updatedAsset.originalFilename,\n        mimeType: updatedAsset.mimeType,\n        size: updatedAsset.size,\n        metadata: {\n          dimensions: updatedAsset.width && updatedAsset.height ? {\n            width: updatedAsset.width,\n            height: updatedAsset.height\n          } : void 0,\n          ...updatedAsset.metadata\n        },\n        title: updatedAsset.title,\n        description: updatedAsset.description,\n        alt: updatedAsset.alt,\n        creditLine: updatedAsset.creditLine,\n        _createdAt: updatedAsset.createdAt,\n        _updatedAt: updatedAsset.updatedAt\n      }\n    });\n  } catch (error) {\n    console.error(\"Error updating asset:\", error);\n    return json({ success: false, error: \"Failed to update asset\" }, { status: 500 });\n  }\n};\nexport {\n  DELETE,\n  GET,\n  PATCH\n};\n"],"names":[],"mappings":";;;;;;;AAGK,MAAC,GAAG,GAAG,OAAO,EAAE,MAAM,EAAE,MAAM,EAAE,KAAK;AAC1C,EAAE,IAAI;AACN,IAAI,MAAM,EAAE,YAAY,EAAE,GAAG,MAAM,CAAC,QAAQ;AAC5C,IAAI,MAAM,IAAI,GAAG,MAAM,CAAC,IAAI;AAC5B,IAAI,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM;AACzB,IAAI,IAAI,CAAC,IAAI,EAAE;AACf,MAAM,OAAO,IAAI,CAAC,EAAE,OAAO,EAAE,KAAK,EAAE,KAAK,EAAE,cAAc,EAAE,EAAE,EAAE,MAAM,EAAE,GAAG,EAAE,CAAC;AAC7E,IAAI;AACJ,IAAI,IAAI,CAAC,EAAE,EAAE;AACb,MAAM,OAAO,IAAI,CAAC,EAAE,OAAO,EAAE,KAAK,EAAE,KAAK,EAAE,sBAAsB,EAAE,EAAE,EAAE,MAAM,EAAE,GAAG,EAAE,CAAC;AACrF,IAAI;AACJ,IAAI,MAAM,KAAK,GAAG,MAAM,YAAY,CAAC,aAAa,CAAC,IAAI,CAAC,cAAc,EAAE,EAAE,CAAC;AAC3E,IAAI,IAAI,CAAC,KAAK,EAAE;AAChB,MAAM,OAAO,IAAI,CAAC,EAAE,OAAO,EAAE,KAAK,EAAE,KAAK,EAAE,iBAAiB,EAAE,EAAE,EAAE,MAAM,EAAE,GAAG,EAAE,CAAC;AAChF,IAAI;AACJ,IAAI,OAAO,IAAI,CAAC;AAChB,MAAM,OAAO,EAAE,IAAI;AACnB,MAAM,IAAI,EAAE;AACZ,QAAQ,KAAK,EAAE,KAAK,CAAC,SAAS,KAAK,OAAO,GAAG,mBAAmB,GAAG,kBAAkB;AACrF,QAAQ,GAAG,EAAE,KAAK,CAAC,EAAE;AACrB,QAAQ,GAAG,EAAE,KAAK,CAAC,GAAG;AACtB,QAAQ,gBAAgB,EAAE,KAAK,CAAC,gBAAgB;AAChD,QAAQ,QAAQ,EAAE,KAAK,CAAC,QAAQ;AAChC,QAAQ,IAAI,EAAE,KAAK,CAAC,IAAI;AACxB,QAAQ,QAAQ,EAAE;AAClB,UAAU,UAAU,EAAE,KAAK,CAAC,KAAK,IAAI,KAAK,CAAC,MAAM,GAAG;AACpD,YAAY,KAAK,EAAE,KAAK,CAAC,KAAK;AAC9B,YAAY,MAAM,EAAE,KAAK,CAAC;AAC1B,WAAW,GAAG,KAAK,CAAC;AACpB,UAAU,GAAG,KAAK,CAAC;AACnB,SAAS;AACT,QAAQ,KAAK,EAAE,KAAK,CAAC,KAAK;AAC1B,QAAQ,WAAW,EAAE,KAAK,CAAC,WAAW;AACtC,QAAQ,GAAG,EAAE,KAAK,CAAC,GAAG;AACtB,QAAQ,UAAU,EAAE,KAAK,CAAC,UAAU;AACpC,QAAQ,UAAU,EAAE,KAAK,CAAC,SAAS;AACnC,QAAQ,UAAU,EAAE,KAAK,CAAC;AAC1B;AACA,KAAK,CAAC;AACN,EAAE,CAAC,CAAC,OAAO,KAAK,EAAE;AAClB,IAAI,OAAO,CAAC,KAAK,CAAC,mCAAmC,EAAE,KAAK,CAAC;AAC7D,IAAI,OAAO,IAAI,CAAC,EAAE,OAAO,EAAE,KAAK,EAAE,KAAK,EAAE,uBAAuB,EAAE,EAAE,EAAE,MAAM,EAAE,GAAG,EAAE,CAAC;AACpF,EAAE;AACF;AACK,MAAC,MAAM,GAAG,OAAO,EAAE,MAAM,EAAE,MAAM,EAAE,KAAK;AAC7C,EAAE,IAAI;AACN,IAAI,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM;AACzB,IAAI,MAAM,EAAE,YAAY,EAAE,GAAG,MAAM,CAAC,QAAQ;AAC5C,IAAI,MAAM,IAAI,GAAG,MAAM,CAAC,IAAI;AAC5B,IAAI,IAAI,CAAC,IAAI,EAAE;AACf,MAAM,OAAO,IAAI,CAAC,EAAE,OAAO,EAAE,KAAK,EAAE,KAAK,EAAE,cAAc,EAAE,EAAE,EAAE,MAAM,EAAE,GAAG,EAAE,CAAC;AAC7E,IAAI;AACJ,IAAI,IAAI,CAAC,EAAE,EAAE;AACb,MAAM,OAAO,IAAI,CAAC,EAAE,OAAO,EAAE,KAAK,EAAE,KAAK,EAAE,sBAAsB,EAAE,EAAE,EAAE,MAAM,EAAE,GAAG,EAAE,CAAC;AACrF,IAAI;AACJ,IAAI,MAAM,MAAM,GAAG,MAAM,YAAY,CAAC,WAAW,CAAC,IAAI,CAAC,cAAc,EAAE,EAAE,CAAC;AAC1E,IAAI,IAAI,CAAC,MAAM,EAAE;AACjB,MAAM,OAAO,IAAI,CAAC,EAAE,OAAO,EAAE,KAAK,EAAE,KAAK,EAAE,yCAAyC,EAAE,EAAE,EAAE,MAAM,EAAE,GAAG,EAAE,CAAC;AACxG,IAAI;AACJ,IAAI,OAAO,IAAI,CAAC,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC;AAClC,EAAE,CAAC,CAAC,OAAO,KAAK,EAAE;AAClB,IAAI,OAAO,CAAC,KAAK,CAAC,uBAAuB,EAAE,KAAK,CAAC;AACjD,IAAI,OAAO,IAAI,CAAC,EAAE,OAAO,EAAE,KAAK,EAAE,KAAK,EAAE,wBAAwB,EAAE,EAAE,EAAE,MAAM,EAAE,GAAG,EAAE,CAAC;AACrF,EAAE;AACF;AACK,MAAC,KAAK,GAAG,OAAO,EAAE,MAAM,EAAE,MAAM,EAAE,OAAO,EAAE,KAAK;AACrD,EAAE,IAAI;AACN,IAAI,MAAM,EAAE,YAAY,EAAE,GAAG,MAAM,CAAC,QAAQ;AAC5C,IAAI,MAAM,IAAI,GAAG,MAAM,CAAC,IAAI;AAC5B,IAAI,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM;AACzB,IAAI,IAAI,CAAC,IAAI,EAAE;AACf,MAAM,OAAO,IAAI,CAAC,EAAE,OAAO,EAAE,KAAK,EAAE,KAAK,EAAE,cAAc,EAAE,EAAE,EAAE,MAAM,EAAE,GAAG,EAAE,CAAC;AAC7E,IAAI;AACJ,IAAI,IAAI,CAAC,EAAE,EAAE;AACb,MAAM,OAAO,IAAI,CAAC,EAAE,OAAO,EAAE,KAAK,EAAE,KAAK,EAAE,sBAAsB,EAAE,EAAE,EAAE,MAAM,EAAE,GAAG,EAAE,CAAC;AACrF,IAAI;AACJ,IAAI,MAAM,EAAE,KAAK,EAAE,WAAW,EAAE,GAAG,EAAE,UAAU,EAAE,GAAG,MAAM,OAAO,CAAC,IAAI,EAAE;AACxE,IAAI,IAAI,YAAY;AACpB,IAAI,IAAI,IAAI,CAAC,IAAI,IAAI,SAAS,EAAE;AAChC,MAAM,YAAY,GAAG,MAAM,YAAY,CAAC,mBAAmB,CAAC,IAAI,CAAC,cAAc,EAAE,EAAE,EAAE;AACrF,QAAQ,KAAK;AACb,QAAQ,WAAW;AACnB,QAAQ,GAAG;AACX,QAAQ,UAAU;AAClB,QAAQ,SAAS,EAAE,IAAI,CAAC,IAAI,CAAC;AAC7B,OAAO,CAAC;AACR,IAAI,CAAC,MAAM;AACX,MAAM,YAAY,GAAG,MAAM,YAAY,CAAC,mBAAmB,CAAC,IAAI,CAAC,cAAc,EAAE,EAAE,EAAE;AACrF,QAAQ,KAAK;AACb,QAAQ,WAAW;AACnB,QAAQ,GAAG;AACX,QAAQ,UAAU;AAClB,QAAQ,SAAS,EAAE,IAAI,CAAC;AACxB,OAAO,CAAC;AACR,IAAI;AACJ,IAAI,IAAI,CAAC,YAAY,EAAE;AACvB,MAAM,OAAO,IAAI,CAAC,EAAE,OAAO,EAAE,KAAK,EAAE,KAAK,EAAE,iBAAiB,EAAE,EAAE,EAAE,MAAM,EAAE,GAAG,EAAE,CAAC;AAChF,IAAI;AACJ,IAAI,OAAO,IAAI,CAAC;AAChB,MAAM,OAAO,EAAE,IAAI;AACnB,MAAM,IAAI,EAAE;AACZ,QAAQ,KAAK,EAAE,YAAY,CAAC,SAAS,KAAK,OAAO,GAAG,mBAAmB,GAAG,kBAAkB;AAC5F,QAAQ,GAAG,EAAE,YAAY,CAAC,EAAE;AAC5B,QAAQ,GAAG,EAAE,YAAY,CAAC,GAAG;AAC7B,QAAQ,gBAAgB,EAAE,YAAY,CAAC,gBAAgB;AACvD,QAAQ,QAAQ,EAAE,YAAY,CAAC,QAAQ;AACvC,QAAQ,IAAI,EAAE,YAAY,CAAC,IAAI;AAC/B,QAAQ,QAAQ,EAAE;AAClB,UAAU,UAAU,EAAE,YAAY,CAAC,KAAK,IAAI,YAAY,CAAC,MAAM,GAAG;AAClE,YAAY,KAAK,EAAE,YAAY,CAAC,KAAK;AACrC,YAAY,MAAM,EAAE,YAAY,CAAC;AACjC,WAAW,GAAG,KAAK,CAAC;AACpB,UAAU,GAAG,YAAY,CAAC;AAC1B,SAAS;AACT,QAAQ,KAAK,EAAE,YAAY,CAAC,KAAK;AACjC,QAAQ,WAAW,EAAE,YAAY,CAAC,WAAW;AAC7C,QAAQ,GAAG,EAAE,YAAY,CAAC,GAAG;AAC7B,QAAQ,UAAU,EAAE,YAAY,CAAC,UAAU;AAC3C,QAAQ,UAAU,EAAE,YAAY,CAAC,SAAS;AAC1C,QAAQ,UAAU,EAAE,YAAY,CAAC;AACjC;AACA,KAAK,CAAC;AACN,EAAE,CAAC,CAAC,OAAO,KAAK,EAAE;AAClB,IAAI,OAAO,CAAC,KAAK,CAAC,uBAAuB,EAAE,KAAK,CAAC;AACjD,IAAI,OAAO,IAAI,CAAC,EAAE,OAAO,EAAE,KAAK,EAAE,KAAK,EAAE,wBAAwB,EAAE,EAAE,EAAE,MAAM,EAAE,GAAG,EAAE,CAAC;AACrF,EAAE;AACF;;;;"}