{"version":3,"file":"permissions-CiX-uXr2.js","sources":["../../../.svelte-kit/adapter-node/chunks/permissions.js"],"sourcesContent":["class PermissionError extends Error {\n  operation;\n  resource;\n  constructor(message, operation, resource) {\n    super(message);\n    this.operation = operation;\n    this.resource = resource;\n    this.name = \"PermissionError\";\n  }\n}\nclass PermissionChecker {\n  _config;\n  schemas;\n  constructor(_config, schemas) {\n    this._config = _config;\n    this.schemas = schemas;\n  }\n  /**\n   * Get the CMS config\n   * Available for future per-collection permission logic\n   */\n  get config() {\n    return this._config;\n  }\n  /**\n   * Check if the current context has read permissions for a collection\n   */\n  async canRead(context, collectionName) {\n    if (context.overrideAccess) {\n      return;\n    }\n    if (!context.user) {\n      throw new PermissionError(\"Authentication required for read operations\", \"read\", collectionName);\n    }\n    return;\n  }\n  /**\n   * Check if the current context has write permissions (create/update)\n   */\n  async canWrite(context, collectionName) {\n    if (context.overrideAccess) {\n      return;\n    }\n    if (!context.user) {\n      throw new PermissionError(\"Authentication required for write operations\", \"write\", collectionName);\n    }\n    if (context.user.role === \"viewer\") {\n      throw new PermissionError(\"Write permission denied. Viewers have read-only access.\", \"write\", collectionName);\n    }\n    return;\n  }\n  /**\n   * Check if the current context has delete permissions\n   */\n  async canDelete(context, collectionName) {\n    if (context.overrideAccess) {\n      return;\n    }\n    if (!context.user) {\n      throw new PermissionError(\"Authentication required for delete operations\", \"delete\", collectionName);\n    }\n    if (context.user.role === \"viewer\" || context.user.role === \"editor\") {\n      throw new PermissionError(\"Delete permission denied. Only admins can delete resources.\", \"delete\", collectionName);\n    }\n    return;\n  }\n  /**\n   * Check if the current context has publish permissions\n   */\n  async canPublish(context, collectionName) {\n    if (context.overrideAccess) {\n      return;\n    }\n    if (!context.user) {\n      throw new PermissionError(\"Authentication required for publish operations\", \"publish\", collectionName);\n    }\n    if (context.user.role === \"viewer\") {\n      throw new PermissionError(\"Publish permission denied. Viewers have read-only access.\", \"publish\", collectionName);\n    }\n    return;\n  }\n  /**\n   * Validate that a collection exists in the schema\n   */\n  validateCollection(collectionName) {\n    if (!this.schemas.has(collectionName)) {\n      throw new Error(`Collection \"${collectionName}\" not found in schema. Available collections: ${Array.from(this.schemas.keys()).join(\", \")}`);\n    }\n  }\n}\nexport {\n  PermissionError as P,\n  PermissionChecker as a\n};\n"],"names":[],"mappings":"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"}