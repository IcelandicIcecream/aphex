{"version":3,"file":"service-CEhtyGUm.js","sources":["../../../.svelte-kit/adapter-node/chunks/service.js"],"sourcesContent":["import { a as auth } from \"./instance.js\";\nimport { d as drizzleDb, u as user, a as apikey } from \"./index3.js\";\nimport { eq } from \"drizzle-orm\";\nimport \"@sveltejs/kit\";\nimport \"./storage.js\";\nimport \"sharp\";\nclass AuthError extends Error {\n  code;\n  constructor(code, message) {\n    super(message);\n    this.code = code;\n    this.name = \"AuthError\";\n  }\n}\nconst authService = {\n  async getSession(request, db) {\n    try {\n      console.log(\"[AuthService]: getSession called.\");\n      const session = await auth.api.getSession({ headers: request.headers });\n      if (!session) {\n        console.log(\"[AuthService]: No active session found from auth provider.\");\n        return null;\n      }\n      console.log(`[AuthService]: Found session for user ${session.user.id}`);\n      console.log(`[AuthService]: Checking for user profile for ${session.user.id}`);\n      let userProfile = await db.findUserProfileById(session.user.id);\n      if (!userProfile) {\n        console.log(\n          `[AuthService]: User profile not found for ${session.user.id}. Creating one now (lazy sync).`\n        );\n        const hasExistingUsers = typeof db.hasAnyUserProfiles === \"function\" ? await db.hasAnyUserProfiles() : false;\n        const isFirstUser = !hasExistingUsers;\n        const newUserProfile = {\n          userId: session.user.id,\n          role: isFirstUser ? \"super_admin\" : \"editor\"\n          // First user gets super_admin, others get editor\n        };\n        userProfile = await db.createUserProfile(newUserProfile);\n        console.log(\n          `[AuthService]: Successfully created user profile for ${session.user.id}${isFirstUser ? \" with SUPER_ADMIN role\" : \"\"}`\n        );\n      }\n      const cmsUser = {\n        id: session.user.id,\n        email: session.user.email,\n        name: session.user.name ?? void 0,\n        image: session.user.image ?? void 0,\n        role: userProfile.role,\n        preferences: userProfile.preferences\n      };\n      console.log(`[AuthService]: Successfully assembled CMSUser for ${session.user.id}`);\n      console.log(`[AuthService]: Fetching active organization for ${session.user.id}`);\n      const userSession = await db.findUserSession(session.user.id);\n      if (!userSession) {\n        console.log(`[AuthService]: No user session found. Fetching user's organizations.`);\n        const userOrgs = await db.findUserOrganizations(session.user.id);\n        if (userOrgs.length === 0) {\n          if (cmsUser.role === \"super_admin\") {\n            console.log(\n              `[AuthService]: Super admin ${session.user.id} has no organizations. Creating default organization.`\n            );\n            const defaultOrg = await db.createOrganization({\n              name: \"Default Organization\",\n              slug: \"default\",\n              createdBy: session.user.id\n            });\n            await db.addMember({\n              organizationId: defaultOrg.id,\n              userId: session.user.id,\n              role: \"owner\"\n            });\n            await db.updateUserSession(session.user.id, defaultOrg.id);\n            console.log(\n              `[AuthService]: Created default organization ${defaultOrg.id} for super admin.`\n            );\n            return {\n              type: \"session\",\n              user: cmsUser,\n              session: {\n                id: session.session.id,\n                expiresAt: session.session.expiresAt\n              },\n              organizationId: defaultOrg.id,\n              organizationRole: \"owner\"\n            };\n          }\n          console.log(\n            `[AuthService]: User ${session.user.id} has no organizations. Checking for pending invitations.`\n          );\n          const invitations = await db.findInvitationsByEmail(session.user.email);\n          const hasPendingInvitations = invitations.some(\n            (inv) => !inv.acceptedAt && inv.expiresAt > /* @__PURE__ */ new Date()\n          );\n          if (hasPendingInvitations) {\n            console.log(\n              `[AuthService]: User ${session.user.id} has pending invitations. Processing them now.`\n            );\n            for (const invitation of invitations.filter(\n              (inv) => !inv.acceptedAt && inv.expiresAt > /* @__PURE__ */ new Date()\n            )) {\n              await db.acceptInvitation(invitation.token, session.user.id);\n              console.log(\n                `[AuthService]: Accepted invitation ${invitation.id} for org ${invitation.organizationId}`\n              );\n            }\n            const firstInvitation = invitations.find(\n              (inv) => !inv.acceptedAt && inv.expiresAt > /* @__PURE__ */ new Date()\n            );\n            if (firstInvitation) {\n              await db.updateUserSession(session.user.id, firstInvitation.organizationId);\n              console.log(\n                `[AuthService]: Set org ${firstInvitation.organizationId} as active for user ${session.user.id}`\n              );\n              const userOrgsAfterAccept = await db.findUserOrganizations(session.user.id);\n              if (userOrgsAfterAccept.length > 0) {\n                const firstOrg2 = userOrgsAfterAccept[0];\n                console.log(\n                  `[AuthService]: User now has ${userOrgsAfterAccept.length} organization(s)`\n                );\n                return {\n                  type: \"session\",\n                  user: cmsUser,\n                  session: {\n                    id: session.session.id,\n                    expiresAt: session.session.expiresAt\n                  },\n                  organizationId: firstOrg2.organization.id,\n                  organizationRole: firstOrg2.member.role\n                };\n              }\n            }\n          }\n          console.error(\n            `[AuthService]: User ${session.user.id} has no organizations and no pending invitations.`\n          );\n          throw new AuthError(\"no_organization\", \"User must belong to at least one organization\");\n        }\n        const firstOrg = userOrgs[0];\n        await db.updateUserSession(session.user.id, firstOrg.organization.id);\n        console.log(`[AuthService]: Set first organization ${firstOrg.organization.id} as active.`);\n        return {\n          type: \"session\",\n          user: cmsUser,\n          session: {\n            id: session.session.id,\n            expiresAt: session.session.expiresAt\n          },\n          organizationId: firstOrg.organization.id,\n          organizationRole: firstOrg.member.role\n        };\n      }\n      console.log(`[AuthService]: Getting membership for org ${userSession.activeOrganizationId}`);\n      const membership = await db.findUserMembership(\n        session.user.id,\n        userSession.activeOrganizationId\n      );\n      if (!membership) {\n        console.error(\n          `[AuthService]: User ${session.user.id} is not a member of org ${userSession.activeOrganizationId}`\n        );\n        throw new AuthError(\"kicked_from_org\", \"User is not a member of the active organization\");\n      }\n      return {\n        type: \"session\",\n        user: cmsUser,\n        session: {\n          id: session.session.id,\n          expiresAt: session.session.expiresAt\n        },\n        organizationId: userSession.activeOrganizationId,\n        organizationRole: membership.role\n      };\n    } catch (error) {\n      if (error instanceof AuthError) {\n        throw error;\n      }\n      console.error(\"[AuthService]: Error in getSession:\", error);\n      return null;\n    }\n  },\n  async requireSession(request, db) {\n    const session = await this.getSession(request, db);\n    if (!session) {\n      throw new Error(\"Unauthorized: Session required\");\n    }\n    return session;\n  },\n  async validateApiKey(request) {\n    try {\n      const apiKeyHeader = request.headers.get(\"x-api-key\");\n      if (!apiKeyHeader) return null;\n      const result = await auth.api.verifyApiKey({ body: { key: apiKeyHeader } });\n      if (!result.valid || !result.key) return null;\n      const metadata = result.key.metadata || {};\n      const permissions = metadata.permissions || [\"read\", \"write\"];\n      const organizationId = metadata.organizationId;\n      if (!organizationId) {\n        console.error(`[AuthService]: API key ${result.key.id} missing organizationId in metadata`);\n        return null;\n      }\n      return {\n        type: \"api_key\",\n        keyId: result.key.id,\n        name: result.key.name || \"Unnamed Key\",\n        permissions,\n        organizationId,\n        lastUsedAt: result.key.lastRequest || void 0\n      };\n    } catch (error) {\n      console.error(\"[AuthService] validateApiKey error:\", error);\n      return null;\n    }\n  },\n  async requireApiKey(request, db, permission) {\n    const apiKeyAuth = await this.validateApiKey(request);\n    if (!apiKeyAuth) {\n      throw new Error(\"Unauthorized: Valid API key required\");\n    }\n    if (permission && !apiKeyAuth.permissions.includes(permission)) {\n      throw new Error(`Forbidden: API key missing ${permission} permission`);\n    }\n    return apiKeyAuth;\n  },\n  async listApiKeys(db, userId) {\n    const userApiKeys = await drizzleDb.query.apikey.findMany({\n      where: eq(apikey.userId, userId),\n      columns: {\n        id: true,\n        name: true,\n        metadata: true,\n        expiresAt: true,\n        lastRequest: true,\n        createdAt: true\n      },\n      orderBy: (apikey2, { desc }) => [desc(apikey2.createdAt)]\n    });\n    return userApiKeys.map((key) => {\n      const metadata = typeof key.metadata === \"string\" ? JSON.parse(key.metadata) : key.metadata || {};\n      return {\n        ...key,\n        permissions: metadata.permissions || [],\n        organizationId: metadata.organizationId\n        // Include organizationId from metadata\n      };\n    });\n  },\n  async createApiKey(userId, organizationId, data) {\n    const expiresIn = data.expiresInDays ? data.expiresInDays * 24 * 60 * 60 : void 0;\n    const result = await auth.api.createApiKey({\n      body: {\n        userId,\n        name: data.name,\n        expiresIn,\n        metadata: {\n          permissions: data.permissions,\n          organizationId\n          // Store organization ID in metadata\n        }\n      }\n    });\n    if (!result || !result.id) {\n      throw new Error(\"Failed to create API key\");\n    }\n    return {\n      id: result.id,\n      name: result.name,\n      key: result.key,\n      permissions: data.permissions,\n      organizationId,\n      // Include in return value\n      expiresAt: result.expiresAt,\n      createdAt: result.createdAt\n    };\n  },\n  async deleteApiKey(userId, keyId) {\n    console.log(`Deleting key ${keyId} for user ${userId}`);\n    return Promise.resolve(true);\n  },\n  async getUserById(userId) {\n    try {\n      const userRecord = await drizzleDb.query.user.findFirst({\n        where: eq(user.id, userId),\n        columns: {\n          id: true,\n          name: true,\n          email: true\n        }\n      });\n      if (!userRecord) {\n        return null;\n      }\n      return {\n        id: userRecord.id,\n        name: userRecord.name ?? void 0,\n        email: userRecord.email\n      };\n    } catch (error) {\n      console.error(\"[AuthService]: Error fetching user by ID:\", error);\n      return null;\n    }\n  },\n  async changeUserName(userId, name) {\n    await drizzleDb.update(user).set({\n      name,\n      updatedAt: /* @__PURE__ */ new Date()\n    }).where(eq(user.id, userId));\n  },\n  async requestPasswordReset(email, redirectTo) {\n    try {\n      await auth.api.forgetPassword({\n        body: {\n          email,\n          redirectTo\n        }\n      });\n    } catch (error) {\n      console.error(\"[AuthService]: Error requesting password reset:\", error);\n      throw error;\n    }\n  },\n  async resetPassword(token, newPassword) {\n    try {\n      await auth.api.resetPassword({\n        body: {\n          newPassword,\n          token\n        }\n      });\n    } catch (error) {\n      console.error(\"[AuthService]: Error resetting password:\", error);\n      throw error;\n    }\n  }\n};\nexport {\n  AuthError as A,\n  authService as a\n};\n"],"names":[],"mappings":"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"}